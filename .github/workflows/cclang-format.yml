name: C/C++ Format Check

on:
  pull_request:
    paths:
      - '**/*.c'
      - '**/*.cpp'
      - '**/*.h'
      - '**/*.hpp'

jobs:
  clang-format-check:
    runs-on: ubuntu-latest

    steps:
      # 1. Checkout code
      - name: Checkout code
        uses: actions/checkout@v3
        with:
          fetch-depth: 0

      # 2. Install clang-format and reviewdog
      - name: Install tools
        run: |
          sudo apt update
          sudo apt install -y clang-format python3-pip
          pip install --upgrade pip
          pip install reviewdog

      # 3. Run clang-format on changed files and post suggestions
      - name: Run clang-format and reviewdog
        run: |
          # Get list of changed C/C++ files in the PR
          FILES=$(git diff --name-only origin/${{ github.base_ref }} -- '*.c' '*.cpp' '*.h' '*.hpp')
          if [ -z "$FILES" ]; then
            echo "âœ” No C/C++ files changed."
            exit 0
          fi

          # Generate clang-format diff for changed files
          git fetch origin ${{ github.base_ref }} --depth=1
